flowchart TD
    root["/"] --> layout[Root Layout]
    layout --> providers[Theme/Auth Providers]
    
    subgraph PublicRoutes["Public Routes"]
        layout --> unauth["/unauthorized"] 
        unauth --> errorPage[Error Page]
    end
    
    subgraph AuthSystem["Authentication System"]
        layout --> auth["/(auth) Group"]
        auth --> login["/login"]
        auth --> register["/register"]
        
        login --> loginForm[Login Form]
        loginForm --> credentials[Credentials Provider]
        loginForm --> authActions[Authentication Actions]
        
        register --> registerForm[Registration Form]
        registerForm --> validation[Form Validation]
        registerForm --> createUser[User Creation]
        registerForm --> login
        
        authActions --> checkRedirect{Role Check}
        checkRedirect -->|Employee| employeeDashboard
        checkRedirect -->|Admin| adminDashboard
        checkRedirect -->|HR| hrDashboard
    end
    
    subgraph EmployeeDash["Employee Dashboard"]
        employeeDashboard["/employee-dashboard"] --> employeeProfile["/employee-dashboard/[userId]"]
        employeeProfile --> calendar[Period Calendar]
        employeeProfile --> records[Health Records List]
        employeeProfile --> statistics[Health Statistics]
        
        calendar --> addRecord[Add Record Modal]
        records --> viewRecord[View Record Details]
        viewRecord --> editRecord[Edit Record]
        viewRecord --> deleteRecord[Delete Record]
    end
    
    subgraph AdminDash["Admin Dashboard"]
        adminDashboard["/admin"] --> userManagement[User Management]
        adminDashboard --> systemConfig[System Configuration]
        adminDashboard --> analytics[Usage Analytics]
        
        userManagement --> addUser[Add User]
        userManagement --> editUser[Edit User]
        userManagement --> assignRoles[Assign User Roles]
    end
    
    subgraph HrDash["HR Dashboard"]
        hrDashboard["/hr-dashboard"] --> employeeList[Employee List]
        hrDashboard --> companyMetrics[Company Metrics]
        hrDashboard --> reports[Generate Reports]
    end
    
    subgraph ChatSystem["Chat System"]
        layout --> chat["/(chat) Group"]
        chat --> aiAssistant[AI Assistant]
        aiAssistant --> messageHistory[Message History]
        aiAssistant --> inputForm[Multimodal Input]
        inputForm --> attachments[File Attachments]
        inputForm --> sendMessage[Send Message]
    end
    
    %% 正确设置子图的样式
    style AuthSystem fill:#f9f9ff,stroke:#9999ff,stroke-width:2px
    style EmployeeDash fill:#f9fff9,stroke:#99ff99,stroke-width:2px
    style AdminDash fill:#fffff9,stroke:#ffff99,stroke-width:2px
    style HrDash fill:#fff9f9,stroke:#ff9999,stroke-width:2px
    style ChatSystem fill:#f9ffff,stroke:#99ffff,stroke-width:2px
    style PublicRoutes fill:#f9f9f9,stroke:#999999,stroke-width:2px