sequenceDiagram
    actor User as User
    participant Frontend as Frontend UI
    participant Auth as Authentication Service
    participant NextAuth as NextAuth.js
    participant Middleware as Auth Middleware
    participant Database as PostgreSQL
    participant Cache as Redis Cache
    
    User->>Frontend: Access application
    Frontend->>Middleware: Check auth status
    Middleware->>NextAuth: Verify session
    NextAuth->>Cache: Check for cached session
    
    alt Session exists in cache
        Cache-->>NextAuth: Return session data
        NextAuth-->>Middleware: Session valid
        Middleware-->>Frontend: User authenticated
        Frontend-->>User: Display appropriate dashboard
    else No valid session
        Cache-->>NextAuth: No session found
        NextAuth-->>Middleware: No valid session
        Middleware-->>Frontend: Redirect to login
        Frontend-->>User: Display login page
        
        User->>Frontend: Enter credentials
        Frontend->>Auth: Submit login request
        Auth->>NextAuth: Process credentials
        NextAuth->>Database: Query user record
        Database-->>NextAuth: Return user data
        
        alt Valid credentials
            NextAuth->>NextAuth: Generate JWT token
            NextAuth->>NextAuth: Create session
            NextAuth->>Cache: Store session data
            NextAuth-->>Auth: Authentication successful
            Auth-->>Frontend: Login successful
            
            Frontend->>NextAuth: Get user role
            NextAuth-->>Frontend: Return user role
            
            alt Role is Employee
                Frontend-->>User: Redirect to employee dashboard
            else Role is Admin
                Frontend-->>User: Redirect to admin dashboard
            else Role is HR
                Frontend-->>User: Redirect to HR dashboard
            end
            
        else Invalid credentials
            NextAuth-->>Auth: Authentication failed
            Auth-->>Frontend: Login failed
            Frontend-->>User: Display error message
        end
    end